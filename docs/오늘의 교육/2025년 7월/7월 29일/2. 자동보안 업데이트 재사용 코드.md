---
layout: default
title: 2. 자동보안 업데이트 재사용 코드
parent: 7월 29일
nav_order: 126
---

# 2025년 7월 29일 교육 내용

오늘 배운 내용을 여기에 정리합니다.

## 이 프로젝트의 전체 목표
이 예제 코드는 미리 만들어 둔 재사용 가능한 Ansible 역할(Role)(unattended_upgrades)을 가져와, 웹 서버와 데이터베이스 서버에 각기 다른 자동 업데이트 설정을 적용하는 과정을 보여주는 것입니다.

site.yml 플레이북 분석
이 파일은 크게 두 부분(두 개의 플레이)으로 나뉩니다.

## 1. 첫 번째 플레이: Configure Web Servers
이 부분의 목표는 an-ksh003 서버를 '웹 서버'로 간주하고 그에 맞는 자동 업데이트 설정을 적용하는 것입니다.

roles: - role: unattended_upgrades: ansible.cfg에 지정된 roles_path 경로에서 unattended_upgrades라는 '설명서(Role)'를 찾아 실행하라고 지시합니다.

vars: '설명서'에 있는 기본 설정값을 덮어쓰는 특별 지시사항입니다. 알림 이메일은 web-admins@example.com으로, 재부팅 시간은 04:00으로 맞춤 설정합니다.

## 2. 두 번째 플레이: Configure Database Servers
이 부분의 목표는 똑같은 an-ksh003 서버를 이번에는 '데이터베이스 서버'로 간주하고 그에 맞는 설정을 적용하는 것입니다.

roles: - role: unattended_upgrades: 동일한 '설명서(Role)'를 다시 한번 실행합니다.

vars: 이번에는 데이터베이스 서버에 맞게 알림 이메일을 db-admins@example.com으로, 재부팅 시간을 02:00으로 다르게 맞춤 설정합니다.

(학습 참고: 이 예제는 하나의 서버(an-ksh003)에 두 가지 설정을 연달아 적용하고 있습니다. 실제로는 마지막에 실행된 'Database Servers'의 설정만 남게 되며, 이는 역할에 변수를 다르게 전달하는 방법을 보여주기 위한 예시일 뿐, 일반적인 사용 사례는 아닙니다.)

## 요약
이 예제는 재사용 가능한 **설명서(Role)**를 가져와, **작업 지시서(Playbook)**에서 vars를 통해 내용을 바꿈으로써 여러 다른 종류의 서버에 맞춤형 설정을 적용하는(1번 플레이, 2번 플레이) 방법을 보여주는 코드입니다.

ksh001@ksh001:~$

mkdir new_infra_project
cd new_infra_project

vi inventory.ini

```
[webservers]
an-ksh003 ansible_host=10.10.8.202

[dbservers]
an-ksh004 ansible_host=10.10.8.203
```

vi site.yml

```
---
- name: Configure Web Servers
  hosts: webservers
  become: true
  roles:
    - role: unattended_upgrades
      vars:
        unattended_mail_to: "web-admins@example.com"
        unattended_reboot_time: "04:00"

- name: Configure Database Servers
  hosts: dbservers
  become: true
  roles:
    - role: unattended_upgrades
      vars:
        unattended_mail_to: "db-admins@example.com"
        unattended_reboot_time: "02:00"
```

ksh001@ksh001:~/new_infra_project$

vi ansible.cfg

```
[defaults]
inventory = ./inventory.ini
# 이전에 롤을 만들었던 디렉터리를 roles_path에 추가
roles_path = ../unattended_upgrades/roles
```

ansible-playbook site.yml
