---
layout: default
title: 5. 맞춤형 웹 페이지를 자동으로 만들어 배포
parent: 2025년 7월
nav_order: 6
---

# 2025년 7월 29일 교육 내용

오늘 배운 내용을 여기에 정리합니다.

## 이 프로젝트의 전체 목표
이 예제 코드는 Nginx 웹 서버를 설치하고, 그 위에 Jinja2 템플릿이라는 기능을 사용해 맞춤형 웹 페이지를 자동으로 만들어 배포하는 전체 과정을 보여주는 것입니다.

create_html.yml 플레이북 분석
이 파일은 크게 두 부분(두 개의 플레이)으로 나뉩니다.

## 1. 첫 번째 플레이: Nginx 설치
이 부분의 목표는 웹 서버 프로그램을 깨끗하게 준비하는 것입니다.

package_facts: 가장 먼저, 서버에 어떤 프로그램들이 이미 설치되어 있는지 목록을 확인합니다.

Purge Apache2 / Nginx: 만약 경쟁 웹 서버인 Apache2나 다른 버전의 Nginx가 설치되어 있다면, 깨끗한 상태에서 시작하기 위해 먼저 삭제합니다. when 조건문은 "만약 OOO이 설치되어 있다면"이라는 조건을 거는 역할입니다.

latest Nginx: 그 다음, 서버의 운영체제(OS)가 우분투인지 레드햇 계열인지에 따라 다른 설치 명령(apt 또는 yum)을 실행합니다.

(학습 참고: 예제 코드의 Redhat/CentOS 조건문은 실제로는 작동하지 않는 문법 오류가 있습니다. OS 계열을 확인할 때는 보통 when: ansible_os_family == "RedHat" 과 같은 방식을 사용합니다.)

## 2. 두 번째 플레이: 웹 페이지 생성
이 부분의 목표는 템플릿을 이용해 index.html 파일을 만드는 것입니다.

vars: 웹 페이지에 들어갈 **내용물(데이터)**인 제목(title), 메시지(message), 목록(items) 등을 미리 변수로 정의합니다.

template 모듈: 이 모듈이 templates/index.html.j2라는 'HTML 설계도' 파일을 읽습니다.

Jinja2 동작: vars에 있던 데이터들을 설계도 안의 {{ title }} 같은 빈칸에 자동으로 채워 넣습니다. {% raw %}{% for %}{% endraw %} 루프를 돌며 목록도 만듭니다. 이렇게 완성된 최종 index.html 파일을 서버의 웹사이트 경로(/var/www/html/)에 배포(복사)합니다.

## 요약
이 예제는 서버 환경을 깨끗하게 정리하고(1번 플레이), 미리 준비된 데이터와 설계도를 조합해 결과물(웹 페이지)을 만들어 배포하는(2번 플레이) 과정을 자동화한 코드입니다.


ksh001@ksh001:~$ 
mkdir ansible-jinja2

ksh001@ksh001:~/ansible-jinja2$ 
vi create_html.yml

```
---
- name: Install Nginx
  hosts: webservers
  become: true
  vars:
    packages:
      - nginx

  tasks:
  - name: Gather facts about installed packages
    ansible.builtin.package_facts:
      manager: auto

  - name: Purge Apache2 if it is installed
    ansible.builtin.apt:
      name: apache2
      state: absent
      purge: yes       # 설정 파일까지 모두 삭제
      autoremove: yes  # 의존성 패키지 자동 삭제
    when: "'apache2' in ansible_facts.packages"

  - name: Purge Nginx if it is installed (for a clean slate)
    ansible.builtin.apt:
      name: nginx
      state: absent
      purge: yes
      autoremove: yes
    when: "'nginx' in ansible_facts.packages"

  - name: lastest Nginx
    ansible.builtin.apt:
      name: "{{ packages }}"
      state: present
    when: ansible_distribution == "Ubuntu" and ansible_distribution_version == "24.04"

  - name: lastest Nginx
    ansible.builtin.yum:
      name: "{{ packages }}"
      state: present
    when: ansible_distribution  == "Redhat" and ansible_distribution_version == "CentOS"

- name: Create default.html from Jinja2 template
  hosts: webservers
  become: true
  vars:
    title: "Welcome to My Website"
    header: "Hello, World!"
    message: "This is a sample HTML file generated using Jinja2."
    items:
      - "Item 1"
      - "Item 2"
      - "Item 3"
  tasks:
    - name: Create index.html from template
      ansible.builtin.template:
        src: templates/index.html.j2
        dest: /var/www/html/index.html
        mode: '0644'
```

ksh001@ksh001:~/ansible-jinja2$ 

## 방법 1

vi inventory.ini

```
[webservers]
an-node2 ansible_host=10.10.8.203
```

## 방법2
```
cat<<EOF>>inventory.ini
[webservers]
an-node2 ansible_host=10.10.8.203
EOF
```

ksh001@ksh001:~/ansible-jinja2$ 
mkdir templates

vi templates/index.html.j2

```
<!DOCTYPE html>
<html>
<head>
    <title>{{ title }}</title>
</head>
<body>
    <h1>{{ header }}</h1>
    <p>{{ message }}</p>
    <ul>
    {% for item in items %}
        <li>{{ item }}</li>
    {% endfor %}
    </ul>
</body>
</html>
```

ansible-playbook -i inventory.ini create_html.yml

curl http://10.10.8.203
