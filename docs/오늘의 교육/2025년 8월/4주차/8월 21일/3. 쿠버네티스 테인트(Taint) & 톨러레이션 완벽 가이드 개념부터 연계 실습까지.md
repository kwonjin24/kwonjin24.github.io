---
layout: default
title: 쿠버네티스 테인트(Taint) & 톨러레이션 완벽 가이드: 개념부터 연계 실습까지
parent: 8월 21일
nav_order: 4
---

# 2025년 8월 20일 교육 내용

# 쿠버네티스

📌 쿠버네티스 테인트(Taint)와 톨러레이션(Toleration) 완벽 정리
1. Taint와 Toleration이란 무엇인가?
테인트와 톨러레이션은 특정 노드(Node)에 아무 Pod나 스케줄링되지 않도록 제어하는 메커니즘입니다. 어피니티(Affinity)가 Pod를 특정 노드로 끌어당기는 **"인력(attraction)"**의 개념이라면, 테인트는 반대로 Pod를 밀어내는 **"척력(repulsion)"**의 개념입니다.

    👉 쉬운 비유: "관계자 외 출입금지" 표지판과 "출입증"

    노드 (Node): 특별한 장비가 있는 중요한 서버실.

    테인트 (Taint): 서버실 문에 붙어있는 "관계자 외 출입금지" 표지판.

    톨러레이션 (Toleration): 특정 Pod가 가지고 있는 "출입증". 이 출입증이 있으면 표지판을 무시하고 들어갈 수 있습니다.

2. 스케줄링 제어 기능 비교
| 기능 | 적용 대상 | 목적 | 강제/선호 |
|---|---|---|---|
| NodeSelector | Pod | 특정 Node 라벨과 완전히 일치하는 곳에 배포 | 강제 |
| Affinity | Pod | Node/Pod 라벨 규칙에 따라 선호하는 곳에 배포 |	강제/선호 | 
| Taint/Toleration | Node/Pod | 특정 Node에 배포되는 것을 제외/허용 | 강제/선호 (NoSchedule, PreferNoSchedule, NoExecute) | 

3. Taint의 3가지 효과(Effect)
| Effect | 설명 | 기존에 실행 중인 Pod에 미치는 영향 |
|---|---|---|
| NoSchedule | "새로운 손님은 받지 않겠습니다." Toleration이 없는 새로운 Pod는 이 노드에 스케줄링될 수 없습니다. | 영향 없음. 이미 실행 중이던 Pod는 그대로 유지됩니다. |
| PreferNoSchedule	| "가급적이면 다른 곳으로 가주세요." NoSchedule의 약한 버전입니다. 클러스터에 다른 배치할 노드가 정말 없을 때만 Toleration이 없는 Pod도 받아줍니다.	 | 영향 없음. |
| NoExecute	"출입증 없는 분은 지금 당장 나가주세요." 새로운 Pod의 스케줄링을 막을 뿐만 아니라, @이미 실행 중인 Pod 중에서 Toleration이 없는 Pod를 즉시 퇴거(evict)**시킵니다. | 	Toleration이 없으면 즉시 퇴거됨. | 
    💡 핵심 개념: 허가와 지정의 차이
    톨러레이션은 특정 노드에 들어갈 수 있는 **'허가증'**일 뿐, 그 노드로 가야만 하는 **'지정석 티켓'**이 아닙니다. 스케줄러는 여전히 자원 상황 등 다른 요소를 고려하여 가장 적합한 노드를 선택하며, 여기에는 테인트가 없는 다른 노드도 포함될 수 있습니다.

4. 실무 시나리오 예시
    1. GPU 등 특수 하드웨어 노드 독점 사용:
    GPU가 장착된 비싼 노드에 kubectl taint nodes gpu-node special=gpu:NoSchedule 와 같이 테인트를 설정합니다. 이렇게 하면, 해당 톨러레이션을 가진 머신러닝 Pod만 이 노드를 사용할 수 있게 되어 자원 낭비를 막을 수 있습니다.

    2. Master 노드 보호:
    쿠버네티스 컨트롤 플레인(Master) 노드에는 기본적으로 테인트가 설정되어 있어, 일반 애플리케이션 Pod들이 스케줄링되는 것을 막습니다. 이를 통해 Master 노드의 자원을 클러스터 관리라는 핵심적인 역할에만 집중하도록 보장합니다.

    3. 노드 유지보수 및 안전한 Pod 이동:
    특정 노드를 재부팅하거나 점검하기 전에 kubectl taint nodes node1 maintenance=true:NoExecute 테인트를 적용합니다. 그러면 해당 노드에서 실행 중이던 모든 Pod들이 다른 노드로 안전하게 옮겨가므로(퇴거), 서비스 중단 없이 유지보수 작업을 진행할 수 있습니다.

5. ⚠️ 주의사항
    스케줄링 실패 가능성: NoSchedule 테인트가 있는 노드만 남았는데 Pod에 해당 톨러레이션이 없다면, Pod는 자원이 있어도 배포되지 못하고 영원히 Pending 상태에 머무를 수 있습니다.

    Pod 퇴거(Eviction) 주의: NoExecute 테인트를 실행 중인 노드에 추가하면, 해당 톨러레이션이 없는 기존 Pod들은 즉시 종료되고 다른 곳으로 재배치됩니다. 의도치 않은 서비스 중단을 유발할 수 있으므로 신중하게 사용해야 합니다.

--------------------------------------------------------------------------

🚀 테인트(Taint)와 톨러레이션(Toleration) 연계 실습 (최종 완성본)
🎯 최종 목표: Taint를 사용하여 특정 노드의 Pod 배치를 제어하고, nodeSelector와의 관계를 이해하며, 최종적으로 Toleration을 사용하여 Taint가 적용된 노드에 Pod를 성공적으로 배포하는 전체 과정을 마스터합니다.

💡 Taint의 3가지 효과(Effect) 요약

Effect	설명	기존에 실행 중인 Pod에 미치는 영향
NoSchedule	"새로운 손님은 받지 않겠습니다." <br> Toleration이 없는 새로운 Pod는 이 노드에 스케줄링될 수 없습니다.	영향 없음. <br> 이미 실행 중이던 Pod는 그대로 유지됩니다.
PreferNoSchedule	"가급적이면 다른 곳으로 가주세요." <br> NoSchedule의 약한 버전입니다. 클러스터에 다른 배치할 노드가 정말 없을 때만 Toleration이 없는 Pod도 받아줍니다.	영향 없음.
NoExecute	"출입증 없는 분은 지금 당장 나가주세요." <br> 새로운 Pod의 스케줄링을 막을 뿐만 아니라, **이미 실행 중인 Pod 중에서 Toleration이 없는 Pod를 즉시 퇴거(evict)**시킵니다.	Toleration이 없으면 즉시 퇴거됨.
실습 1: Taint 설정 및 배포 제한 확인
목표: 특정 노드에 **테인트(Taint)**를 적용하여, 톨러레이션(Toleration)이 없는 Pod는 해당 노드를 피해 다른 곳에 배포되는 것을 확인합니다.

1단계: 준비 - 특정 노드에 Taint 설정하기
node1.labs.local 노드에 Pod들이 스케줄링되지 않도록 NoSchedule 효과의 테인트를 적용합니다.

Bash

# node1에 Taint 적용
$ kubectl taint nodes node1.labs.local special-node=true:NoSchedule

# Taint가 올바르게 적용되었는지 확인
$ kubectl describe node node1.labs.local | grep Taints
2단계: Toleration이 없는 Deployment 배포
Toleration이 없는 일반적인 Nginx Deployment를 배포합니다.

nginx-deploy.yaml 파일을 생성하고 적용합니다.

YAML

# nginx-deploy.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: deployment-nginx
spec:
  replicas: 5
  selector:
    matchLabels:
      app: pod-nginx
  template:
    metadata:
      labels:
        app: pod-nginx
    spec:
      containers:
      - name: nginx
        image: nginx
Bash

$ kubectl apply -f nginx-deploy.yaml
$ kubectl get pods -o wide
✨ 핵심 확인 포인트: 생성된 Pod들이 테인트가 설정된 node1.labs.local을 피해서, 나머지 노드에만 분산 배포된 것을 확인합니다.

실습 2: Taint와 nodeSelector 충돌 확인
목표: nodeSelector로 Pod를 테인트가 적용된 node1에 강제로 배포하도록 지정했을 때, 스케줄링이 실패하여 Pending 상태에 빠지는 것을 확인합니다.

1단계: nodeSelector가 추가된 Deployment 배포
nginx-deploy-conflict.yaml 파일을 생성하고 적용합니다.

YAML

# nginx-deploy-conflict.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: deployment-nginx-conflict
spec:
  replicas: 1
  selector:
    matchLabels:
      app: pod-nginx-conflict
  template:
    metadata:
      labels:
        app: pod-nginx-conflict
    spec:
      nodeSelector:
        kubernetes.io/hostname: node1.labs.local
      containers:
      - name: nginx
        image: nginx
Bash

$ kubectl apply -f nginx-deploy-conflict.yaml
$ kubectl get pods
✨ 핵심 확인 포인트: Pod가 Running이 아닌 Pending 상태에 머무르는 것을 확인합니다.

2단계: Pending 원인 분석
describe pod 명령어로 스케줄링 실패의 원인이 테인트 때문임을 직접 확인합니다.

Bash

$ kubectl describe pod <pod-name>
Events 섹션에서 "node(s) had taint ..., that the pod didn't tolerate" 메시지를 통해 실패 원인을 명확히 알 수 있습니다.

실습 3: Toleration 적용 및 문제 해결
목표: Pending 상태 문제를, Pod에 **톨러레이션(Toleration)**을 추가하여 해결합니다.

1단계: Toleration이 포함된 Deployment 배포
node1에 설정된 테인트를 용인할 수 있는 tolerations 설정을 Pod 템플릿에 추가합니다.

nginx-deploy-toleration.yaml 파일을 생성하고 적용합니다.

YAML

# nginx-deploy-toleration.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: deployment-nginx-toleration
spec:
  replicas: 5
  selector:
    matchLabels:
      app: pod-nginx-toleration
  template:
    metadata:
      labels:
        app: pod-nginx-toleration
    spec:
      tolerations:
      - key: "special-node"
        operator: "Equal"
        value: "true"
        effect: "NoSchedule"
      containers:
      - name: nginx
        image: nginx
Bash

$ kubectl apply -f nginx-deploy-toleration.yaml
$ kubectl get pods -o wide
✨ 핵심 확인 포인트: 이제 Pod들이 "출입증"을 가졌기 때문에, 테인트가 설정된 node1.labs.local에도 정상적으로 배포되는 것을 확인할 수 있습니다.

📜 Taint와 Toleration 관계 및 실습 요약
**테인트(Taint)**는 노드에 "이런 Pod는 받지 않겠다"는 규칙을 부여하는 것이고, **톨러레이션(Toleration)**은 Pod에 "나는 그런 규칙을 가진 노드라도 들어갈 수 있다"는 허용 자격을 부여하는 것입니다. 이번 연계 실습을 통해 우리는 다음을 확인했습니다.

Taint가 설정된 노드는 Toleration 없는 Pod의 배치를 거부합니다.

**nodeSelector**로 Taint가 설정된 노드를 강제 지정하면, Toleration이 없는 Pod는 Pending 상태에 빠집니다.

Pod에 Taint와 일치하는 Toleration을 부여하면, 해당 노드에 정상적으로 배포될 수 있습니다.

이러한 특성을 활용하면 특정 노드를 전용 목적으로 예약하거나, 노드 유지보수 시 Pod를 안전하게 이동시키는 등 정교한 스케줄링 제어가 가능해집니다.

실습 마무리: 전체 리소스 정리
Bash

# 모든 Deployment 삭제
$ kubectl delete deployment --all

# node1의 Taint 제거
$ kubectl taint nodes node1.labs.local special-node